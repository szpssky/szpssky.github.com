---
title: Apache CXF+SSH搭建webservice
date: 2014-04-08 18:22:39
tags: 
- Apache CXF
- Webservice
categories: 
- Java
comments: true
banner: /image/asf_logo.png
---
之前几次的项目后台这方面一直由我来负责，经过几次使用也比较熟悉了，趁着刚建了个blog就介绍下webservice环境配置。
## 准备工作
首先要去Apache 网站下载CXF jar包,structs2、spring、hibernate的库可以自己下载，如果是用myeclipse用集成的也可以。
关于Apache CXF 所必须要使用的Jar包如果嫌麻烦可以直接把libs里的文件全部拷出来，如果和SSH里重复了移除就好，这里就不再多说了。
## 集成环境
进入正题，当把所有依赖的jar包都准备完成的时候，把所有jar文件复制到WEB-INI/lib目录里即可。
建立spring的配置文件applicationContext.xml：
<!-- more -->
内容如下
``` XML
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:jaxws="http://cxf.apache.org/jaxws" xmlns:soap="http://cxf.apache.org/bindings/soap"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans 
		http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
		http://cxf.apache.org/bindings/soap 
		http://cxf.apache.org/schemas/configuration/soap.xsd   
		http://cxf.apache.org/jaxws   
		http://cxf.apache.org/schemas/jaxws.xsd">
	<import resource="classpath:META-INF/cxf/cxf.xml" />
	<import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
	<import resource="classpath:META-INF/cxf/cxf-servlet.xml" />
	<bean id="dataSource"
		class="org.springframework.jdbc.datasource.DriverManagerDataSource">
		<property name="driverClassName" value="com.mysql.jdbc.Driver">
		</property>
		<property name="url" value="jdbc:mysql://localhost:3306/memo"></property>
		<property name="username" value="root"></property>
		<property name="password" value="root"></property>
	</bean>
	<bean id="sessionFactory"
		class="org.springframework.orm.hibernate3.LocalSessionFactoryBean">
		<property name="dataSource">
			<ref bean="dataSource" />
		</property>
		<property name="hibernateProperties">
			<props>
				<prop key="hibernate.dialect">
					org.hibernate.dialect.MySQLDialect
				</prop>
			</props>
		</property>
        <!--这里主要是hibernate的映射文件的地方 -->
		<property name="mappingResources">
			<list>
		        <value>domain/SystemManagement/Account.hbm.xml</value>
			</list>
		</property>
	</bean>
```
数据库源部分根据各自情况配置吧主要就是url、username以及password
PS:因为这里使用spring来管理hibernate所以hibernate的配置文件可以省略了不用单独再配置了。
接下来在web.xml里配置spring的监听器以及启动CXF的servelt代码如下：
``` XML
<?xml version="1.0" encoding="UTF-8"?>
<web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee 
	http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd">
	<display-name>webservice_cxf</display-name>
	<context-param>
		<param-name>contextConfigLocation</param-name>
		<param-value>classpath:applicationContext.xml</param-value>
	</context-param>

	<listener>
		<listener-class>org.springframework.web.context.ContextLoaderListener</listener-class>
	</listener>
	<!-- CXF Servlet -->
	<servlet>
		<servlet-name>CXFServlet</servlet-name>
		<servlet-class>org.apache.cxf.transport.servlet.CXFServlet</servlet-class>
		<load-on-startup>1</load-on-startup>
	</servlet>
	<servlet-mapping>
		<servlet-name>CXFServlet</servlet-name>
		<url-pattern>/*</url-pattern>
	</servlet-mapping>

	<welcome-file-list>
		<welcome-file>index.jsp</welcome-file>
	</welcome-file-list>
</web-app>
```
环境配置到此结束下面就是实现功能。
## 功能实现
首先建立domain包用于放实体，这里我以简单的登陆用例说明
Account.java
``` Java
public abstract class AbstractAccount implements java.io.Serializable {

	// Fields

	private String tel;
	private String pwd;

	// Constructors

	/** default constructor */
	public AbstractAccount() {
	}

	/** minimal constructor */
	public AbstractAccount(String tel) {
		this.tel = tel;
	}

	/** full constructor */
	public AbstractAccount(String tel, String pwd) {
		this.tel = tel;
		this.pwd = pwd;
	}

	// Property accessors

	public String getTel() {
		return this.tel;
	}

	public void setTel(String tel) {
		this.tel = tel;
	}

	public String getPwd() {
		return this.pwd;
	}

	public void setPwd(String pwd) {
		this.pwd = pwd;
	}

}
```
同时配置好hibernate的映射
``` XML
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
<!-- 
    Mapping file autogenerated by MyEclipse Persistence Tools
-->
<hibernate-mapping>
    <class name="com.demo.domain.Account" table="account">
        <id name="tel" type="java.lang.String">
            <column name="tel" length="13" />
            <generator class="assigned" />
        </id>
        <property name="pwd" type="java.lang.String">
            <column name="pwd" length="17" />
        </property>
    </class>
</hibernate-mapping>

```
再建立service用以处理业务逻辑
``` Java
package com.demo.service;

import javax.jws.WebParam;
import javax.jws.WebService;

@WebService
public interface ISystemManagementService {
	public boolean login(@WebParam(name = "tel") String tel,
			@WebParam(name = "pwd") String pwd);

	public boolean register(@WebParam(name = "tel") String tel,
			@WebParam(name = "pwd") String pwd);
}
```
``` Java
package com.demo.service;

import org.springframework.context.ApplicationContext;
import org.springframework.context.support.ClassPathXmlApplicationContext;

import com.demo.domain.Account;
import com.demo.domain.AccountDAO;

public class SystemManagementService implements ISystemManagementService {
	private AccountDAO accountDAO;
	private ApplicationContext ctx;
	@Override
	public boolean login(String tel, String pwd) {
		ctx = new ClassPathXmlApplicationContext("applicationContext.xml");
		accountDAO = AccountDAO.getFromApplicationContext(ctx);
		Account account = accountDAO.findById(tel);
		if(account!=null){
			if(account.getPwd().equals(pwd))
				return true;
		}
		return false;
	}

	@Override
	public boolean register(String tel, String pwd) {
		ctx = new ClassPathXmlApplicationContext("applicationContext.xml");
		accountDAO = AccountDAO.getFromApplicationContext(ctx);
		Account account = new Account();
		account.setTel(tel);
		account.setPwd(pwd);
		try {
			accountDAO.save(account);
			return true;
		} catch (Exception e) {
			e.printStackTrace();
		}
	
		return false;
	}

}

```
写完后在spring的配置文件中配置CXF的bean就可以正常利用spring注入数据源等
``` XML
<!-- SystemManagerment -->
	<bean id="SystemManagement" class="com.demo.service.SystemManagementService">
	</bean>
	<jaxws:server id="management"
		serviceClass="com.demo.service.ISystemManagementService" address="/SystemManagement">
		<jaxws:serviceBean>
			<ref bean="SystemManagement" />
		</jaxws:serviceBean>
	</jaxws:server>
```
当用localhost访问出现wsdl文档是说明webservice搭建成功。
关于structs2的集成只需要在structs2的配置文件里加上
``` XML
<constant name="struts.objectFactory" value="spring" />
```
在web.xml里加上
``` XML
filter>
  	<filter-name>struts2</filter-name>
  	<filter-class>
  		org.apache.struts2.dispatcher.ng.filter.StrutsPrepareAndExecuteFilter
  	</filter-class>
  </filter>
  <filter-mapping>
  	<filter-name>struts2</filter-name>
  	<url-pattern>/*</url-pattern>
  </filter-mapping>
```
即可，至于struct2的用法这里就不说明啦

转载请注明出处，谢谢。